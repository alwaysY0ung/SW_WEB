<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User List</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
<h1>User List</h1>
<table id="userTable">
    <thead>
    <tr>
        <th>Time</th>
        <th>WaitingNumber</th>
        <th>WaitingSpot</th>
        <th>Major</th>
        <th>ID</th>
        <th>Name</th>
        <th>Receipt</th>
        <th>Receipt Button</th>
    </tr>
    </thead>
    <tbody id="userTableBody">
    <!-- 데이터가 여기에 동적으로 추가됩니다 -->
    </tbody>
</table>

<script>
    function fetchUsers() {
        fetch('/Users/getUsers')
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('userTableBody');
                tableBody.innerHTML = ''; // 기존 데이터 지우기
                data.forEach(user => {
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = new Date(user.Time).toLocaleString();
                    row.insertCell(1).textContent = user.WaitingNumber;
                    row.insertCell(2).textContent = user.WaitingSpot;
                    row.insertCell(3).textContent = user.Major;
                    row.insertCell(4).textContent = user.ID;
                    row.insertCell(5).textContent = user.Name;
                    row.insertCell(6).textContent = user.Receipt ? 'Received' : 'Not Received';

                    const buttonCell = row.insertCell(7);
                    const button = document.createElement('button');
                    button.textContent = user.Receipt ? 'Mark as Not Received' : 'Mark as Received';
                    button.onclick = () => updateReceipt(user.ID, !user.Receipt);
                    buttonCell.appendChild(button);
                });
            })
            .catch(error => console.error('Error:', error));
    }

    function updateReceipt(id, received) {
        const endpoint = received ? '/api/received' : '/api/notReceived';
        fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ NUID: id }),
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchUsers(); // 데이터 다시 불러오기
                } else {
                    console.error('Failed to update receipt status');
                }
            })
            .catch(error => console.error('Error:', error));
    }

    // 페이지 로드 시 사용자 데이터 가져오기
    fetchUsers();

    // 10초마다 데이터 새로고침
    setInterval(fetchUsers, 10000);
</script>
</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>User List</title>-->
<!--    <style>-->
<!--        table {-->
<!--            width: 100%;-->
<!--            border-collapse: collapse;-->
<!--        }-->
<!--        table, th, td {-->
<!--            border: 1px solid black;-->
<!--        }-->
<!--        th, td {-->
<!--            padding: 8px;-->
<!--            text-align: left;-->
<!--        }-->
<!--        th {-->
<!--            background-color: #f2f2f2;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<h1>User List</h1>-->
<!--<table id="userTable">-->
<!--    <thead>-->
<!--    <tr>-->
<!--        <th>Time</th>-->
<!--        <th>WaitingNumber</th>-->
<!--        <th>WaitingSpot</th>-->
<!--        <th>Major</th>-->
<!--        <th>ID</th>-->
<!--        <th>Name</th>-->
<!--        <th>Receipt</th>-->
<!--        <th>Receipt Button</th>-->
<!--    </tr>-->
<!--    </thead>-->
<!--    <tbody>-->
<!--    &lt;!&ndash; Data will be inserted here &ndash;&gt;-->
<!--    </tbody>-->
<!--</table>-->

<!--<script>-->
<!--    // Fetch data from the /getUsers endpoint-->
<!--    async function fetchUsers() {-->
<!--        try {-->
<!--            const response = await fetch('/Users/getUsers');-->
<!--            const data = await response.json();-->

<!--            if (data.status_code === 200) {-->
<!--                const tableBody = document.querySelector('#userTable tbody');-->
<!--                tableBody.innerHTML = ''; // Clear existing rows-->

<!--                data.users.forEach(user => {-->
<!--                    // Create a new row for each user-->
<!--                    const row = document.createElement('tr');-->
<!--                    row.innerHTML = `-->
<!--                            <td>${user.WaitingSpot}</td>-->
<!--                            <td>${user.Time}</td>-->
<!--                            <td>${user.ID}</td>-->
<!--                            <td>${user.Major}</td>-->
<!--                            <td>${user.Name}</td>-->
<!--                            <td>${user.NUID}</td>-->
<!--                            <td>${user.Membership}</td>-->
<!--                            <td id="receipt-${user.ID}">${user.Receipt}</td>-->
<!--                            <td>-->
<!--                                <button onclick="Received(${user.ID})">Received</button><br>-->
<!--                                <button onclick="NotReceived(${user.ID})">Not Received</button>-->
<!--                            </td>-->
<!--                        `;-->
<!--                    tableBody.appendChild(row);-->
<!--                });-->
<!--            } else {-->
<!--                console.log('No users found.');-->
<!--            }-->
<!--        } catch (error) {-->
<!--            console.error('Error fetching user data:', error);-->
<!--        }-->
<!--    }-->

<!--    async function Received(ID) {-->

<!--        const response = await fetch(`/Users/Received/${ID}`, {-->
<!--            method: 'POST',-->
<!--            headers: {-->
<!--                'Content-Type': 'application/json'-->
<!--            },-->
<!--        });-->

<!--        if (response.ok) {-->
<!--            console.log("Receipt updated successfully");-->
<!--        } else {-->
<!--            console.error("Failed to update receipt");-->
<!--        }-->

<!--    }-->

<!--    async function NotReceived(ID) {-->

<!--        const response = await fetch(`/Users/NotReceived/${ID}`, {-->
<!--            method: 'POST',-->
<!--            headers: {-->
<!--                'Content-Type': 'application/json'-->
<!--            },-->
<!--        });-->

<!--        if (response.ok) {-->
<!--            console.log("Receipt updated successfully");-->
<!--        } else {-->
<!--            console.error("Failed to update receipt");-->
<!--        }-->

<!--    }-->

<!--    window.onload = () => {-->
<!--        fetchUsers();-->

<!--        // 1초마다 데이터 가져옴-->
<!--        setInterval(fetchUsers, 10000); // 과부화 걱정 돼서 우선 10초로 진행-->
<!--    };-->

<!--</script>-->
<!--</body>-->
<!--</html>-->